<% if (character) { %>

    <h2>Personaje: <span id="characterName"><%= character.name %></span></h2>
    <p id="energyLevel">Nivel de Energ칤a: <%= character.energyLevel %> 丘뫮잺</p>
    <p id="lifePoints">Puntos de Vida: <%= character.lifePoints %> 仇벒잺</p>

    <h1>ByteMon: <span id="byteMonName"><%= character.initial %></span></h1>

    <!-- Aqu칤 se mostrar치 el GIF correspondiente a su ByteMon -->
    <div id="gifContainer">
        <img id="normalGif" src="/images/<%= character.initial.toLowerCase() %>/evo1.gif" alt="GIF" />
    </div>

    <!-- Mensaje de evoluci칩n -->
    <div id="evolutionMessage" style="display:none;">
        춰Se est치 evolucionando a <span id="currentByteMon"><%= character.initial %></span>!
    </div>

    <h2>Acciones</h2>
    <button onclick="updateEnergy('sound')">Sonido 游댉</button>
    <button onclick="updateEnergy('attack')">Ataque 游녥</button>
    <button onclick="updateEnergy('attackCharged')">Ataque Cargado 游녥游녥</button>

    <h2>Curaci칩n</h2>
    <button onclick="updateEnergy('feedBerry')">Baya 游삃</button>
    <button onclick="updateEnergy('feedPotion')">Poci칩n 游꽆</button>

    <script>
        let attackCounter = 0; // Contador para los ataques

        // Array de rutas din치micas de GIFs para mostrar en los diferentes niveles
        const gifs = [
            `/images/<%= character.initial.toLowerCase() %>/evo1.gif`, // GIF para los primeros 5 ataques
            `/images/<%= character.initial.toLowerCase() %>/evo2.gif`, // GIF para los siguientes 10 ataques
            `/images/<%= character.initial.toLowerCase() %>/evo3.gif`, // GIF para los siguientes 15 ataques
            `/images/<%= character.initial.toLowerCase() %>/evo4.gif`, // GIF para los siguientes 20 ataques
            `/images/<%= character.initial.toLowerCase() %>/evo5.gif`  // GIF para los siguientes 25 ataques
        ];

        // Array de rutas din치micas de sonidos para los diferentes niveles
        const sounds = [
            `/sounds/<%= character.initial.toLowerCase() %>/sound1.mp3`, // Sonido para los primeros 5 ataques
            `/sounds/<%= character.initial.toLowerCase() %>/sound2.mp3`, // Sonido para los siguientes 10 ataques
            `/sounds/<%= character.initial.toLowerCase() %>/sound3.mp3`, // Sonido para los siguientes 15 ataques
            `/sounds/<%= character.initial.toLowerCase() %>/sound4.mp3`, // Sonido para los siguientes 20 ataques
            `/sounds/<%= character.initial.toLowerCase() %>/sound5.mp3`  // Sonido para los siguientes 25 ataques
        ];

        // Nombres evolutivos correspondientes
        const evolutionNames = {
            'Charmander': 'Charmeleon',
            'Charmeleon': 'Charizard',
            'Charizard': 'Mega-Charizard',
            'Squirtle': 'Wartortle',
            'Wartortle': 'Blastoise',
            'Bulbasaur': 'Ivysaur',
            'Ivysaur': 'Venusaur'
        };

        function showEvolutionMessage() {
            const evolutionMessage = document.getElementById('evolutionMessage');
            evolutionMessage.style.display = 'block'; // Mostrar el mensaje

            setTimeout(() => {
                evolutionMessage.style.display = 'none'; // Ocultar el mensaje despu칠s de 3 segundos
            }, 3000); // Tiempo de 3 segundos para el mensaje de evoluci칩n
        }

        function playSound(index) {
            const audio = new Audio(sounds[index]); // Crea un nuevo objeto de Audio con la ruta del sonido
            audio.play(); // Reproduce el sonido
        }

        function updateEnergy(action) {
            fetch('/game/update', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ action: action })
            })
            .then(response => response.json())
            .then(data => {
                // Actualizar el nivel de energ칤a en la interfaz
                document.getElementById('energyLevel').innerText = 'Nivel de Energ칤a: ' + data.energyLevel + ' 丘뫮잺';
                // Actualizar los puntos de vida en la interfaz
                document.getElementById('lifePoints').innerText = 'Puntos de Vida: ' + data.lifePoints + ' 仇벒잺';

                // Incrementar el contador si la acci칩n es un ataque
                if (action === 'attack' || action === 'attackCharged') {
                    attackCounter++;
                    
                    // Cada vez que se alcance un m칰ltiplo de 5, cambiar el GIF y reproducir el sonido
                    if (attackCounter % 5 === 0) {
                        const gifIndex = (attackCounter / 5) - 1; // Obtener el 칤ndice del GIF correspondiente
                        if (gifIndex < gifs.length) { // Verificar que no se exceda el n칰mero de GIFs
                            document.getElementById('normalGif').src = gifs[gifIndex]; // Cambiar la fuente del GIF

                            // Cambiar el nombre del ByteMon
                            const currentByteMon = document.getElementById('byteMonName');
                            const currentName = currentByteMon.innerText;
                            const newByteMonName = evolutionNames[currentName] || currentName; // Obtener el nuevo nombre
                            currentByteMon.innerText = newByteMonName; // Actualizar el nombre

                            // Actualizar el mensaje de evoluci칩n con el nombre del ByteMon
                            document.getElementById('currentByteMon').innerText = newByteMonName;

                            // Mostrar mensaje de evoluci칩n temporalmente
                            showEvolutionMessage();

                            // Reproducir el sonido correspondiente al evolucionar
                            playSound(gifIndex);
                        }
                    }
                }

                // Si la acci칩n es "sound", simplemente reproducir el sonido correspondiente
                if (action === 'sound') {
                    const soundIndex = Math.floor(attackCounter / 5); // Determina el 칤ndice de sonido
                    if (soundIndex < sounds.length) {
                        playSound(soundIndex);
                    }
                }
            })
            .catch(error => console.error('Error al actualizar:', error));
        }
    </script>

<% } else { %>
    <p>No hay ning칰n personaje seleccionado.</p>
    <a href="/characters">Seleccionar Personaje</a>
<% } %>

